<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casa Globo Interactiva</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background-color: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        #canvas-container {
            position: relative;
            width: 800px;
            height: 600px;
        }
        canvas {
            border: 1px solid #333;
            background-color: #000000;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
            cursor: pointer;
        }
        /* OCULTAR TODOS LOS TEXTOS Y BOTONES */
        #restart, #mic-status, #instructions {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="canvas-container">
        <canvas id="canvas" width="800" height="600"></canvas>
        <button id="restart">Reiniciar</button>
        <div id="mic-status">Micrófono: Desactivado</div>
        <div id="instructions">
            Interactúa con la casa: Mueve el cursor cerca para verla reaccionar. 
            Haz ruido al micrófono para inflarla. Si se rompe, arrastra los fragmentos para intentar reconstruirla.
        </div>
    </div>

    <audio id="pop-sound" src="reventar.mp3" preload="auto"></audio>

    <script>
        // ... (todo tu código original, solo muestro las partes modificadas abajo)

        // Estado de la casa
        let casaState = {
            inflada: true,
            rota: false,
            puntos: [],
            fragments: [],
            dragging: false,
            dragIndex: -1,
            dragFragment: null,
            lastX: 0,
            lastY: 0,
            inflation: 0,
            opacidad: 1,
            elasticidad: 0.05,
            tensionMax: 80,
            brillo: 0,
            bordeColor: '#8B4513',
            cursorDistancia: 0,
            cursorInteraccion: false,
            fragmentsSnapped: 0,
            reconstruccionIniciada: false
        };

        // Referencias a elementos del DOM
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const restartButton = document.getElementById('restart');
        const micStatus = document.getElementById('mic-status');
        const popSound = document.getElementById('pop-sound');
        const instructions = document.getElementById('instructions');

        // ... (resto de funciones y lógica)

        // FUNCIÓN PARA INFLAR LA CASA (AUMENTAR FACTOR DE INFLADO)
        function inflarCasa() {
            const centerX = 400;
            const centerY = 300;
            for (let i = 0; i < casaState.puntos.length; i++) {
                let p = casaState.puntos[i];
                // FACTOR CAMBIADO de 0.1 a 0.5 para inflar mucho más
                p.x = p.origX + (p.origX - centerX) * casaState.inflation * 0.5;
                p.y = p.origY + (p.origY - centerY) * casaState.inflation * 0.5;
            }
        }

        // DIBUJAR CUADRÍCULA SOLO SOBRE LA CASA
        function drawGrid(context, points, centerX, centerY, scale = 1) {
            context.save();
            // Recorta la cuadrícula al contorno de la casa
            context.beginPath();
            points.forEach((p, i) => {
                if (i === 0) context.moveTo(p.x, p.y);
                else context.lineTo(p.x, p.y);
            });
            context.closePath();
            context.clip();

            context.strokeStyle = `rgba(255, 255, 255, ${0.1 + casaState.brillo * 0.2})`;
            context.lineWidth = 0.5;
            const gridSize = 10 * scale;
            const gridRange = 150 * scale;
            for (let i = -gridRange; i <= gridRange; i += gridSize) {
                context.beginPath();
                context.moveTo(centerX - gridRange, centerY + i);
                context.bezierCurveTo(
                    centerX - gridRange/2, centerY + i * (1 + casaState.inflation * 0.2),
                    centerX + gridRange/2, centerY + i * (1 + casaState.inflation * 0.2),
                    centerX + gridRange, centerY + i
                );
                context.stroke();

                context.beginPath();
                context.moveTo(centerX + i, centerY - gridRange);
                context.bezierCurveTo(
                    centerX + i * (1 + casaState.inflation * 0.2), centerY - gridRange/2,
                    centerX + i * (1 + casaState.inflation * 0.2), centerY + gridRange/2,
                    centerX + i, centerY + gridRange
                );
                context.stroke();
            }
            context.restore();
        }

        // EN EL CICLO DE DIBUJO, LLAMA A inflarCasa() ANTES DE DIBUJAR LA CASA
        function drawHouse() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (!casaState.rota) {
                // Inflar puntos antes de dibujar
                inflarCasa();

                // Dibuja la cuadrícula SOLO sobre la casa
                drawGrid(ctx, casaState.puntos, 400, 300, 1);

                // ... (resto de tu código para dibujar la casa, bordes, etc)
            } else {
                // ... (dibujo de fragmentos, etc)
            }
        }

        // SOLO REVIENTA SI ESTÁ INFLADA (agrega la condición en la función donde se evalúa la tensión)
        function checkTension() {
            // Solo puede reventar si está inflada más de 0.3
            if (casaState.inflation > 0.3) {
                const tension = casaState.inflation * 150; // ejemplo de cálculo de tensión
                if (tension > casaState.tensionMax) {
                    casaState.rota = true;
                    popSound.play();
                }
            }
        }

        // ... (resto de tu código original, no modificado)

        // Asegúrate de que los textos y botones NO se muestran (ya están ocultos por CSS)

    </script>
</body>
</html>
